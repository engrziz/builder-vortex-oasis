import { RequestHandler } from "express";

export interface ChatRequest {
  message: string;
  conversationHistory?: Array<{ role: 'user' | 'assistant'; content: string }>;
}

export interface ChatResponse {
  response: string;
  error?: string;
}

// Simple Arabic financial education responses for children
const getFinancialResponse = (message: string): string => {
  const lowerMessage = message.toLowerCase().trim();
  
  const responses: Record<string, string> = {
    'Ø³ÙŠÙˆÙ„Ø©': 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù‡ÙŠ Ø³Ù‡ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù†Ù‚ÙˆØ¯! ğŸ’§ Ù…Ø«Ù„ Ø¨ÙŠØ¹ Ù„Ø¹Ø¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚ÙˆØ¯. Ø§Ù„Ø¨ÙŠØª ØµØ¹Ø¨ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Ù‚Ùˆï¿½ï¿½ (Ø³ÙŠÙˆÙ„Ø© Ù‚Ù„ÙŠÙ„Ø©) Ù„ÙƒÙ† Ø§Ù„Ù†Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø³Ù‡Ù„ Ø³Ø­Ø¨Ù‡Ø§ (Ø³ÙŠÙˆÙ„Ø© Ø¹Ø§Ù„ÙŠØ©)! ğŸ¦ğŸ’°',
    'Ø³ÙŠÙˆÙ„Ù‡': 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù‡ÙŠ Ø³Ù‡ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù†Ù‚ÙˆØ¯! ğŸ’§ Ù…Ø«Ù„ Ø¨ÙŠØ¹ Ù„Ø¹Ø¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚ÙˆØ¯. Ø§Ù„Ø¨ÙŠØª ØµØ¹Ø¨ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Ù‚ÙˆØ¯ (Ø³ÙŠÙˆÙ„Ø© Ù‚Ù„ÙŠÙ„Ø©) Ù„ÙƒÙ† Ø§Ù„Ù†Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø³Ù‡Ù„ Ø³Ø­Ø¨Ù‡Ø§ (Ø³ÙŠÙˆÙ„Ø© Ø¹Ø§Ù„ÙŠØ©)! ğŸ¦ğŸ’°',
    'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©': 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù‡ÙŠ Ø³Ù‡ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù†Ù‚ÙˆØ¯! ğŸ’§ Ù…Ø«Ù„ Ø¨ÙŠØ¹ Ù„Ø¹Ø¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚ÙˆØ¯. Ø§Ù„Ø¨ÙŠØª ØµØ¹Ø¨ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Ù‚ÙˆØ¯ (Ø³ÙŠÙˆÙ„Ø© Ù‚Ù„ÙŠÙ„Ø©) Ù„ÙƒÙ† Ø§Ù„Ù†Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø³Ù‡Ù„ Ø³Ø­Ø¨Ù‡Ø§ (Ø³ÙŠÙˆÙ„Ø© Ø¹Ø§Ù„ÙŠØ©)! ğŸ¦ğŸ’°',
    'Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©': 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù‡ÙŠ Ø³Ù‡ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù†Ù‚ÙˆØ¯! ğŸ’§ Ù…Ø«Ù„ Ø¨ÙŠØ¹ Ù„Ø¹Ø¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚ÙˆØ¯. Ø§Ù„Ø¨ÙŠØª ØµØ¹Ø¨ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Ù‚ÙˆØ¯ (Ø³ÙŠÙˆÙ„Ø© Ù‚Ù„ÙŠÙ„Ø©) Ù„ÙƒÙ† Ø§Ù„Ù†Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø³Ù‡Ù„ Ø³Ø­Ø¨Ù‡Ø§ (Ø³ÙŠÙˆÙ„Ø© Ø¹Ø§Ù„ÙŠØ©)! ğŸ¦ğŸ’°',
    'Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©': 'Ø§Ù„Ø³ÙŠÙˆÙ„Ø© Ù‡ÙŠ Ø³Ù‡ÙˆÙ„Ø© ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø¥Ù„Ù‰ Ù†Ù‚ÙˆØ¯! ğŸ’§ Ù…Ø«Ù„ Ø¨ÙŠØ¹ Ù„Ø¹Ø¨ØªÙƒ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Ù‚ÙˆØ¯. Ø§Ù„Ø¨ÙŠØª ØµØ¹Ø¨ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„Ù†Ù‚ÙˆØ¯ (Ø³ÙŠÙˆÙ„Ø© Ù‚ï¿½ï¿½ÙŠÙ„Ø©) Ù„ÙƒÙ† Ø§Ù„Ù†Ù‚ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø³Ù‡Ù„ Ø³Ø­Ø¨Ù‡Ø§ (Ø³ÙŠÙˆÙ„Ø© Ø¹Ø§Ù„ÙŠØ©)! ğŸ¦ğŸ’°',
    
    'Ù…Ø±Ø­Ø¨Ø§': 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ù„ØªØ¹Ù„Ù… Ø§Ù„Ø£Ø³Ù‡Ù… ÙˆØ§Ù„Ù…Ø§Ù„ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø³Ù‡Ù„Ø© ÙˆÙ…Ù…ØªØ¹Ø©! ğŸŒŸ Ø§Ø³Ø£Ù„Ù†ÙŠ Ø£ÙŠ Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ù…Ø§Ù„!',
    'Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…': 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ ØªØ¹Ù„Ù… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„ÙŠÙˆÙ…ØŸ ğŸ˜Š',
    'Ù‡Ù„Ø§': 'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ¹Ù„Ù… Ø´ÙŠØ¡ Ø¬Ø¯ÙŠØ¯ Ø¹Ù† Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØ§Ù„Ø£Ø³Ù‡Ù…ØŸ ğŸˆ',
    
    'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù…': 'Ø§Ù„Ø£Ø³Ù‡Ù… Ù‡ÙŠ Ù…Ø«Ù„ Ù‚Ø·Ø¹ ØµØºÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª! ğŸ§© Ø¹Ù†Ø¯Ù…Ø§ ØªØ´ØªØ±ÙŠ Ø³Ù‡Ù…Ø§Ù‹ØŒ ØªØµØ¨Ø­ Ù…Ø§Ù„ÙƒØ§Ù‹ Ù„Ø¬Ø²Ø¡ ØµØºÙŠØ± Ù…Ù† ØªÙ„Ùƒ Ø§Ù„Ø´Ø±ÙƒØ©. Ù…Ø«Ù„ Ù„Ùˆ ÙƒØ§Ù† Ù„Ø¯ÙŠÙƒ Ù‚Ø·Ø¹Ø© Ù…Ù† ÙƒØ¹ÙƒØ© ÙƒØ¨ÙŠØ±Ø©! ğŸ°',
    'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø³Ù‡Ù…': 'Ø§Ù„Ø³Ù‡Ù… Ù‡Ùˆ Ù…Ø«Ù„ ØªØ°ÙƒØ±Ø© Ø¯Ø®ÙˆÙ„ Ù„ØªØµØ¨Ø­ Ø´Ø±ÙŠÙƒØ§Ù‹ ÙÙŠ Ø´Ø±ÙƒØ©! ğŸ« ÙƒÙ„Ù…Ø§ Ù†Ø¬Ø­Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø£ÙƒØ«Ø±ØŒ ÙƒÙ„Ù…Ø§ Ø£ØµØ¨Ø­Øª ØªØ°ÙƒØ±ØªÙƒ Ø£ØºÙ„Ù‰! ğŸ’°',
    'ÙƒÙŠÙ Ø£Ø´ØªØ±ÙŠ Ø£Ø³Ù‡Ù…': 'Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ù‡Ù…ØŒ ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù† ØªÙƒØ¨Ø± ÙˆØªÙØªØ­ Ø­Ø³Ø§Ø¨Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ù†Ùƒ Ø£Ùˆ Ø´Ø±ÙƒØ© Ø§Ù„ÙˆØ³Ø§Ø·Ø©. Ù„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø£Ù† ØªØªØ¹Ù„Ù… ÙˆØªØ®Ø·Ø·! ğŸ“šâœ¨',
    
    'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø§Ù„': 'Ø§Ù„Ù…Ø§Ù„ Ù‡Ùˆ ÙˆØ³ÙŠÙ„Ø© Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„ØªÙŠ Ù†Ø­ØªØ§Ø¬Ù‡Ø§ ÙˆÙ†Ø±ÙŠØ¯Ù‡Ø§! ğŸ’° Ù…Ø«Ù„ Ø§Ù„Ø·Ø¹Ø§Ù… ÙˆØ§Ù„Ø£Ù„Ø¹Ø§Ø¨ ÙˆØ§Ù„ÙƒØªØ¨. ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„Ø¹Ù…Ù„ ÙˆØ§Ù„Ø§Ø¯Ø®Ø§Ø±! ğŸ¦',
    'ÙƒÙŠÙ Ø£ÙˆÙØ± Ø§Ù„Ù…Ø§Ù„': 'ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ø§Ù„ Ø¨ÙˆØ¶Ø¹ Ø¬Ø²Ø¡ Ù…Ù† Ù…ØµØ±ÙˆÙÙƒ ÙÙŠ Ø­ØµØ§Ù„Ø©! Ù…Ø«Ù„Ø§Ù‹ØŒ Ø¥Ø°Ø§ Ø£Ø¹Ø·Ø§Ùƒ ÙˆØ§Ù„Ø¯Ø§Ùƒ 10 Ø±ÙŠØ§Ù„ØŒ Ø¶Ø¹ Ø±ÙŠØ§Ù„ÙŠÙ† ÙÙŠ Ø§Ù„Ø­ØµØ§Ù„Ø© ÙˆØ§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø§Ù‚ÙŠ! ğŸ’¡',
    'Ù„Ù…Ø§Ø°Ø§ Ù†ÙˆÙØ± Ø§Ù„Ù…Ø§Ù„': 'Ù†ÙˆÙØ± Ø§Ù„Ù…Ø§Ù„ Ù„Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„! ğŸŒŸ Ù…Ø«Ù„ Ø´Ø±Ø§Ø¡ Ù„Ø¹Ø¨Ø© ØºØ§Ù„ÙŠØ©ØŒ Ø£Ùˆ Ø§Ù„Ø¯Ø±Ø§Ø³Ø© ÙÙŠ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©ØŒ Ø£Ùˆ Ø­ØªÙ‰ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†! â¤ï¸',
    
    'Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±': 'Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø± Ù…Ø«Ù„ Ø²Ø±Ø§Ø¹Ø© Ø§Ù„Ø¨Ø°ÙˆØ±! ğŸŒ± ØªØ¶Ø¹ Ù…Ø§Ù„Ùƒ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù† Ù„ÙŠÙ†Ù…Ùˆ ÙˆÙŠØµØ¨Ø­ Ø£ÙƒØ«Ø± Ù…Ø¹ Ø§Ù„ÙˆÙ‚ØªØŒ Ù…Ø«Ù„ Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„ØªÙŠ ØªÙƒØ¨Ø± ÙˆØªØ¹Ø·ÙŠ Ø«Ù…Ø§Ø±Ø§Ù‹! ğŸŒ³ğŸ',
    'Ù„Ù…Ø§Ø°Ø§ Ø£Ø³ØªØ«Ù…Ø±': 'Ù†Ø³ØªØ«Ù…Ø± Ù„Ø£Ù† Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ø°ÙŠ Ù†ØªØ±ÙƒÙ‡ Ù†Ø§Ø¦Ù…Ø§Ù‹ Ù„Ø§ ÙŠÙ†Ù…Ùˆ! ğŸ˜´ Ù„ÙƒÙ† Ø§Ù„Ù…Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ«Ù…Ø± ÙŠØ¹Ù…Ù„ Ù„Ù†Ø§ Ø­ØªÙ‰ ÙˆÙ†Ø­Ù† Ù†Ø§Ø¦Ù…ÙˆÙ†! Ù…Ø«Ù„ Ø§Ù„Ù†Ø­Ù„Ø© Ø§Ù„ØªÙŠ ØªØµÙ†Ø¹ Ø§Ù„Ø¹Ø³Ù„! ğŸğŸ¯',
    
    'Ù‡Ù„ Ø§Ù„Ø£Ø³Ù‡Ù… Ø¢Ù…Ù†Ø©': 'Ø§Ù„Ø£Ø³Ù‡Ù… Ù…Ø«Ù„ Ø±ÙƒÙˆØ¨ Ø§Ù„Ø£Ø±Ø¬ÙˆØ­Ø©! ğŸ¢ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Øªï¿½ï¿½Ø¹Ø¯ ÙˆØ£Ø­ÙŠØ§Ù†Ø§Ù‹ ØªÙ†Ø²Ù„. Ù„Ù‡Ø°Ø§ Ù†ØªØ¹Ù„Ù… Ø£ÙˆÙ„Ø§Ù‹ ÙˆÙ†Ø³ØªØ«Ù…Ø± Ø£Ù…ÙˆØ§Ù„Ø§Ù‹ Ù‚Ù„ÙŠÙ„Ø© ÙÙ‚Ø·! Ø§Ù„Ø£Ù…Ø§Ù† ÙŠØ£ØªÙŠ Ù…Ù† Ø§Ù„ØªØ¹Ù„Ù…! ğŸ“–',
    'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±': 'Ø§Ù„Ù…Ø®Ø§Ø·Ø± Ù…Ø«Ù„ Ø§Ù„Ù…Ø·Ø±! â˜” Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ ØªØ­Ø¯Ø«ØŒ Ù„ÙƒÙ† Ø¥Ø°Ø§ ÙƒÙ†Ø§ Ù…Ø³ØªØ¹Ø¯ÙŠÙ† Ø¨Ø§Ù„Ù…Ø¸Ù„Ø© (Ø§Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„ØªØ®Ø·ÙŠØ·)ØŒ Ù„Ù† Ù†Ø¨ØªÙ„ ÙƒØ«ÙŠØ±Ø§Ù‹! ğŸŒ‚',
    
    'ÙƒÙŠÙ Ø£Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø¯Ø®Ø§Ø±': 'Ø§Ø¨Ø¯Ø£ Ø¨Ø­ØµØ§Ù„Ø© ØµØºÙŠØ±Ø©! Ø¶Ø¹ ÙÙŠÙ‡Ø§ Ø±ÙŠØ§Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ ÙƒÙ„ ÙŠÙˆÙ…ØŒ ÙˆØ³ØªÙ†Ø¯Ù‡Ø´ ÙƒÙ… Ø³ØªØ¬Ù…Ø¹ ÙÙŠ Ø§Ù„Ø´Ù‡Ø±! Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ù…Ø«Ù„ Ù„Ø¹Ø¨Ø© Ù…Ù…ØªØ¹Ø©! ğŸ®',
    'Ù…Ø§ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ø§Ø¯Ø®Ø§Ø±': 'Ø§Ù„Ø§Ø¯Ø®Ø§Ø± Ù…Ø«Ù„ Ø§Ù„Ù…Ø¸Ù„Ø© ÙÙŠ ÙŠÙˆÙ… Ù…Ù…Ø·Ø±! â˜‚ï¸ ÙŠØ­Ù…ÙŠÙ†Ø§ Ø¹Ù†Ø¯Ù…Ø§ Ù†Ø­ØªØ§Ø¬ Ø§Ù„Ù…Ø§Ù„ ÙØ¬Ø£Ø©ØŒ ÙˆÙŠØ³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ø£Ø­Ù„Ø§Ù…Ù†Ø§ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©! âœ¨',
    
    'ØªØ¶Ø§Ø±Ø¨': 'Ø§Ù„ØªØ¶Ø§Ø±Ø¨ Ù‡Ùˆ Ø´Ø±Ø§Ø¡ ÙˆØ¨ÙŠØ¹ Ø§Ù„Ø£Ø³Ù‡Ù… Ø¨Ø³Ø±Ø¹Ø© Ù„Ø±Ø¨Ø­ Ø³Ø±ÙŠØ¹! ğŸ¢ Ù…Ø«Ù„ Ø´Ø±Ø§Ø¡ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙŠÙˆÙ… Ø¨Ù€10 Ø±ÙŠØ§Ù„ ÙˆØ¨ÙŠØ¹Ù‡Ø§ ØºØ¯Ø§Ù‹ Ø¨Ù€15 Ø±ÙŠØ§Ù„. Ù„ÙƒÙ† Ø§Ø­Ø°Ø±! Ù‚Ø¯ ØªÙ†Ø®ÙØ¶ Ù„Ù€5 Ø±ÙŠØ§Ù„! Ø¥Ù†Ù‡Ø§ Ù…Ø«Ù„ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆÙØ© Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±! ğŸ¯âš ï¸',
    'Ù…Ø§ Ù…Ø¹Ù†Ù‰ ØªØ¶Ø§Ø±Ø¨': 'Ø§Ù„ØªØ¶Ø§Ø±Ø¨ Ù‡Ùˆ Ø´Ø±Ø§Ø¡ ÙˆØ¨ÙŠØ¹ Ø§Ù„Ø£Ø³Ù‡Ù… Ø¨Ø³Ø±Ø¹Ø© Ù„Ø±Ø¨Ø­ Ø³Ø±ÙŠØ¹! ğŸ¢ Ù…Ø«Ù„ Ø´Ø±Ø§Ø¡ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙŠÙˆÙ… Ø¨Ù€10 Ø±ÙŠØ§Ù„ ÙˆØ¨ÙŠØ¹Ù‡ï¿½ï¿½ ØºØ¯Ø§Ù‹ Ø¨Ù€15 Ø±ÙŠØ§Ù„. Ù„ÙƒÙ† Ø§Ø­Ø°Ø±! Ù‚Ø¯ ØªÙ†Ø®ÙØ¶ Ù„Ù€5 Ø±ÙŠØ§Ù„! Ø¥Ù†Ù‡Ø§ Ù…Ø«Ù„ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆÙØ© Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±! ğŸ¯âš ï¸',
    'Ù…Ø¹Ù†Ù‰ Ø§Ù„ØªØ¶Ø§Ø±Ø¨': 'Ø§Ù„ØªØ¶Ø§Ø±Ø¨ Ù‡Ùˆ Ø´Ø±Ø§Ø¡ ÙˆØ¨ÙŠØ¹ Ø§Ù„Ø£Ø³Ù‡Ù… Ø¨Ø³Ø±Ø¹Ø© Ù„Ø±Ø¨Ø­ Ø³Ø±ÙŠØ¹! ğŸ¢ Ù…Ø«Ù„ Ø´Ø±Ø§Ø¡ Ù„Ø¹Ø¨Ø© Ø§Ù„ÙŠÙˆÙ… Ø¨Ù€10 Ø±ÙŠØ§Ù„ ÙˆØ¨ÙŠØ¹Ù‡Ø§ ØºØ¯Ø§Ù‹ Ø¨Ù€15 Ø±ÙŠØ§Ù„. Ù„ÙƒÙ† Ø§Ø­Ø°Ø±! Ù‚Ø¯ ØªÙ†Ø®ÙØ¶ Ù„Ù€5 Ø±ÙŠØ§Ù„! Ø¥Ù†Ù‡Ø§ Ù…Ø«Ù„ Ù„Ø¹Ø¨Ø© Ù…Ø­ÙÙˆÙØ© Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±! ğŸ¯âš ï¸',
    
    'Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¯Ø§ÙˆÙ„': 'Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù‡Ùˆ Ø¨ÙŠØ¹ ÙˆØ´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ù‡Ù…! ğŸ“ˆğŸ“‰ Ù…Ø«Ù„ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦ÙƒØŒ Ù„ÙƒÙ† Ø¨Ø§Ù„Ø£Ø³Ù‡Ù…! ÙŠØ­ØªØ§Ø¬ ØµØ¨Ø± ÙˆØªØ¹Ù„Ù… ÙƒØ«ÙŠØ± Ù‚Ø¨Ù„ Ø£Ù† ØªØ¨Ø¯Ø£!',
    'ÙƒÙŠÙ Ø£ØªØ¯Ø§ÙˆÙ„': 'Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ù„Ù„ÙƒØ¨Ø§Ø± ÙÙ‚Ø·! ğŸ‘¨â€ğŸ’¼ ØªØ­ØªØ§Ø¬ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù† ØªØªØ¹Ù„Ù… ÙƒØ«ÙŠØ±Ø§Ù‹ ÙˆØªÙƒØ¨Ø± ÙˆØªÙÙ‡Ù… Ø§Ù„Ù…Ø®Ø§Ø·Ø±. Ø§Ù„Ø¢Ù† Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø¯Ø®Ø§Ø± ÙˆØªØ¹Ù„Ù… Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„! ğŸ“š',
    
    'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¨ÙˆØ±ØµØ©': 'Ø§Ù„Ø¨ÙˆØ±ØµØ© Ù…Ø«Ù„ Ø³ÙˆÙ‚ ÙƒØ¨ÙŠØ± Ù„Ù„Ø£Ø³Ù‡Ù…! ğŸª Ø§Ù„Ù†Ø§Ø³ ÙŠØ£ØªÙˆÙ† Ù„ÙŠØ´ØªØ±ÙˆØ§ ÙˆÙŠØ¨ÙŠØ¹ÙˆØ§ Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª. Ù…Ø«Ù„ Ø³ÙˆÙ‚ Ø§Ù„Ø®Ø¶Ø§Ø± Ù„ÙƒÙ† Ù„Ù„Ø£Ø³Ù‡Ù…! ğŸ“Š',
    'Ø¨ÙˆØ±ØµØ©': 'Ø§Ù„Ø¨ÙˆØ±ØµØ© Ù…Ø«Ù„ Ø³ÙˆÙ‚ ÙƒØ¨ÙŠØ± Ù„Ù„Ø£Ø³Ù‡Ù…! ğŸª Ø§Ù„Ù†Ø§Ø³ ÙŠØ£ØªÙˆÙ† Ù„ÙŠØ´ØªØ±ÙˆØ§ ÙˆÙŠØ¨ÙŠØ¹ÙˆØ§ Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª. Ù…Ø«Ù„ Ø³ÙˆÙ‚ Ø§Ù„Ø®Ø¶Ø§Ø± Ù„ÙƒÙ† Ù„Ù„Ø£Ø³Ù‡Ù…! ğŸ“Š'
  };
  
  // Check for exact matches first
  for (const [key, response] of Object.entries(responses)) {
    if (lowerMessage.includes(key)) {
      return response;
    }
  }
  
  // Default response for financial topics
  return 'Ù‡Ø°Ø§ Ø³Ø¤Ø§Ù„ Ø±Ø§Ø¦Ø¹! ğŸŒŸ Ø£Ù†Ø§ Ø£ØªØ®ØµØµ ÙÙŠ ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØ§Ù„Ø£Ø³Ù‡Ù… Ù„Ù„Ø£Ø·ÙØ§Ù„. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø£Ù† ØªØ³Ø£Ù„ Ø¹Ù† Ø´ÙŠØ¡ Ù…ØªØ¹Ù„Ù‚ Ø¨Ø§Ù„Ù…Ø§Ù„ Ø£Ùˆ Ø§Ù„Ø£Ø³Ù‡Ù…ØŸ Ù…Ø«Ù„ "Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø£Ø³Ù‡Ù…ØŸ" Ø£Ùˆ "ÙƒÙŠÙ Ø£ÙˆÙØ± Ø§Ù„Ù…Ø§Ù„ØŸ" Ø£Ùˆ "Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø³ÙŠÙˆÙ„Ø©ØŸ" ğŸ’°ğŸ“š';
};

export const handleAIChat: RequestHandler = async (req, res) => {
  try {
    const { message }: ChatRequest = req.body;

    if (!message || typeof message !== 'string') {
      return res.status(400).json({ 
        error: "Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…Ø·Ù„ÙˆØ¨Ø©",
        response: "ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø³Ø¤Ø§Ù„Ùƒ! ğŸ˜Š"
      });
    }

    // Use our enhanced financial education responses
    const response = getFinancialResponse(message);
    
    console.log('âœ… Smart financial AI response generated!');
    
    const chatResponse: ChatResponse = { response };
    res.json(chatResponse);

  } catch (error) {
    console.error('Chat API Error:', error);
    
    const fallbackResponse = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ! ğŸ˜… Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ø£Ø¹Ù„Ù…Ùƒ Ø¹Ù† Ø§Ù„Ø£Ù…ÙˆØ§Ù„ ÙˆØ§Ù„Ø£Ø³Ù‡Ù…! ğŸ’°ğŸ“š";
    
    res.status(500).json({ 
      error: 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…',
      response: fallbackResponse
    });
  }
};
